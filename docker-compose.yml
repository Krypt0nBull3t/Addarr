# filename: docker-compose.yml
# author: Christian Blank (https://github.com/Cyneric)
# created date: 2024-11-08
# description: Docker compose file for Addarr Refresh Telegram Bot.

version: '3'
services:
  addarr:
    container_name: addarr-refresh
    build: .
    restart: unless-stopped
    # Host networking is used because Addarr is a Telegram bot that makes
    # outbound connections only (no listening ports). It needs to reach
    # Radarr, Sonarr, Lidarr, Transmission, and SABnzbd which typically
    # run on the same host. Host mode avoids the need to configure bridge
    # networking or explicit port mappings for each service.
    #
    # To use bridge networking instead (e.g. for Docker Swarm or stricter
    # network isolation), remove this line and ensure Addarr can reach
    # your media services via their container names or host.docker.internal.
    network_mode: host
    volumes:
      - ./config.yaml:/app/config.yaml:ro
      - ./chatid.txt:/app/chatid.txt:rw
      - ./admin.txt:/app/admin.txt:ro
      - ./allowlist.txt:/app/allowlist.txt:ro
      - ./logs:/app/logs:rw
      - ./backup:/app/backup:rw
    environment:
      - PYTHONPATH=/app
    healthcheck:
      test: ["CMD", "pgrep", "-f", "python.*run.py"]
      interval: 60s
      timeout: 10s
      start_period: 30s
      retries: 3
    deploy:
      resources:
        limits:
          memory: 256M
